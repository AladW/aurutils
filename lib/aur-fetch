#!/bin/bash
readonly argv0=fetch
readonly PS4='+(${BASH_SOURCE}:${LINENO}): ${FUNCNAME[0]:+${FUNCNAME[0]}(): }'
declare mode=git
declare log_dir=/dev/null

print() {
    printf -- '%s\n' "$@"
}
readonly -f print

usage() {
    base64 -d <<EOF
ICAgICAgICAgICAgIC4tLX5+LF9fCjotLi4uLiwtLS0tLS0tYH5+Jy5fLicKIGAtLCwsICAsXyAg
ICAgIDsnflUnCiAgXywtJyAsJ2AtX187ICctLS4KIChfLyd+fiAgICAgICcnJycoOwoK
EOF
    printf -- 'usage: %s [-gt] [-L log_dir] pkgname [pkgname...]\n' "$argv0" >&2
    exit 1
}
readonly -f usage

# XXX add recursive mode (aur-deps-rpc)
while getopts :gtL: opt; do
    case $opt in
        L) log_dir=$OPTARG ;;
        g) mode=git ;;
        t) mode=tar ;;
        *) usage    ;;
    esac
done
shift $((OPTIND -1))
OPTIND=1

if ((!$#)); then
    usage
fi

case $mode in
    git) print "$@" | aur-fetch-git      -L "$log_dir" ;;
    tar) print "$@" | aur-fetch-snapshot -L "$log_dir" ;;
      *) print "$argv0: invalid argument" >&2
         exit 22 ;;
esac
